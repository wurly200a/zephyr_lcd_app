/ {
	chosen { zephyr,display = &ili9341; };
	aliases { display = &ili9341; };
};

/* 必要な dt-bindings（順不同） */
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/spi/spi.h>           /* SPI_HALF_DUPLEX 用 */
#include <dt-bindings/mipi_dbi/mipi_dbi.h>
#include <dt-bindings/display/ili9xxx.h>

&spi3 {
	status = "okay";
	use-iomux;                       /* IO_MUX 直結（高速時に安定） */
	pinctrl-0 = <&spim3_default>;    /* MOSI=23, MISO=19, SCLK=18, CSEL=5（CSはGPIOで別管理） */
	pinctrl-names = "default";
	cs-gpios = <&gpio0 26 GPIO_ACTIVE_LOW>;

	/* MIPI-DBI ラッパ（SPI を使うバス） */
	mipi_dbi: mipi-dbi-spi@0 {
		compatible = "zephyr,mipi-dbi-spi";
		reg = <0>;
		status = "okay";

		/* MIPI-DBI が使う SPI コントローラ */
		spi-dev = <&spi3>;

		/* D/C, RESET */
		dc-gpios    = <&gpio0 27 GPIO_ACTIVE_HIGH>;
		reset-gpios = <&gpio0 33 GPIO_ACTIVE_LOW>;

		/* ★周波数は bus 側は clock-frequency で指定（まずは 8 MHz） */
		clock-frequency = <8000000>;

		#address-cells = <1>;
		#size-cells = <0>;

		ili9341: display@0 {
			compatible = "ilitek,ili9340";
			reg = <0>;
			status = "okay";

			width = <240>;
			height = <320>;
            rotation = <90>;

			/* 子(デバイス)側での MIPI 設定類 */
			mipi-mode         = "MIPI_DBI_MODE_SPI_4WIRE";
			pixel-format      = <ILI9XXX_PIXEL_FORMAT_RGB565>;
			mipi-max-frequency = <8000000>;     /* デバイス側の上限 */
//			duplex            = <SPI_HALF_DUPLEX>; /* 半二重に明示 */
			/* 必要に応じて：mipi-cpol; mipi-cpha; mipi-hold-cs; など */

//			display-inversion;
		};
	};
};
