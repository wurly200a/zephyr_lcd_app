/ {
	chosen { zephyr,display = &ili9341; };
	aliases { display = &ili9341; };
};

/* 必要な dt-bindings */
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/spi/spi.h>
#include <dt-bindings/mipi_dbi/mipi_dbi.h>
#include <dt-bindings/display/ili9xxx.h>

&spi3 {
	status = "okay";
	use-iomux;
	pinctrl-0 = <&spim3_default>;   /* MOSI=23, MISO=19, SCLK=18 */
	pinctrl-names = "default";

	/* ★ LCD用CS(26) と Touch用CS(21) の2本。間にカンマが要る！ */
	cs-gpios = <&gpio0 26 GPIO_ACTIVE_LOW>, <&gpio0 21 GPIO_ACTIVE_LOW>;

	/* MIPI-DBI ラッパ */
	mipi_dbi: mipi-dbi-spi@0 {
		compatible = "zephyr,mipi-dbi-spi";
		reg = <0>;
		status = "okay";

		/* MIPI-DBI が使う SPI デバイス（親の &spi3 を指定） */
		spi-dev = <&spi3>;

		dc-gpios    = <&gpio0 27 GPIO_ACTIVE_HIGH>;
		reset-gpios = <&gpio0 33 GPIO_ACTIVE_LOW>;
		clock-frequency = <20000000>;

		#address-cells = <1>;
		#size-cells = <0>;

		ili9341: display@0 {
			compatible = "ilitek,ili9340";
			reg = <0>;
			status = "okay";

			width = <240>;
			height = <320>;
			rotation = <90>;

			mipi-mode           = "MIPI_DBI_MODE_SPI_4WIRE";
			pixel-format        = <ILI9XXX_PIXEL_FORMAT_RGB565>;
			mipi-max-frequency  = <40000000>;
			mipi-hold-cs;
		};
	};

	/* XPT2046（reg=1 → 上の cs-gpios の2本目=IO21 を使う） */
	xpt2046: touchscreen@1 {
		compatible = "xptek,xpt2046";
		reg = <1>;
		status = "okay";
		spi-max-frequency = <2000000>;

		int-gpios = <&gpio0 22 GPIO_ACTIVE_LOW>; /* PENIRQ */

		/* 画面解像度（表示側 320x240 に合わせる） */
		touchscreen-size-x = <320>;
		touchscreen-size-y = <240>;

		/* 仮キャリブレーション（後で微調整） */
		min-x = <200>;  max-x = <3900>;
		min-y = <200>;  max-y = <3900>;
	};
};

/* ★ ここがポイント：必ず / { ... } の中に作る ★ */
 / {
     lvgl_touch: lvgl_pointer_input {
         compatible = "zephyr,lvgl-pointer-input";
         input = <&xpt2046>;     /* ← phandle */
         display = <&ili9341>;   /* ← phandle */
         swap-xy;                /* rotation=90 ならまずコレ */
         /* 必要なら
          * invert-x;
          * invert-y;
          */
     };
 };